# نظام إدارة المواعيد - دليل التشغيل

## نظرة عامة
تم إنشاء نظام شامل لإدارة المواعيد في لوحة تحكم الأدمن، يتيح التحكم في تشغيل/إيقاف المواعيد بسهولة.

## الملفات المُنشأة

### 1. قاعدة البيانات
- **Migration**: `database/migrations/2024_01_01_000000_create_time_slots_table.php`
- **Model**: `app/Models/TimeSlot.php`
- **Controller**: `app/Http/Controllers/API/TimeSlotController.php`

### 2. API Endpoints
- **GET** `/api/time-slots?date=YYYY-MM-DD` - الحصول على المواعيد لليوم المحدد
- **GET** `/api/time-slots/booked?date=YYYY-MM-DD` - الحصول على المواعيد المحجوزة
- **POST** `/api/time-slots/book` - حجز موعد
- **GET** `/api/admin/time-slots?date=YYYY-MM-DD` - إدارة المواعيد (أدمن فقط)
- **POST** `/api/admin/time-slots/toggle` - تشغيل/إيقاف موعد (أدمن فقط)
- **POST** `/api/admin/time-slots/release` - إلغاء حجز موعد (أدمن فقط)

### 3. لوحة تحكم الأدمن
- **صفحة الإدارة**: `public/admin/time-slots.html`

## خطوات التشغيل

### 1. تشغيل Migration
```bash
php artisan migrate
```

### 2. الوصول لصفحة الإدارة
افتح المتصفح وانتقل إلى:
```
http://your-domain.com/admin/time-slots.html
```

### 3. تسجيل الدخول كأدمن
- تحتاج إلى token صالح للأدمن
- يمكن الحصول عليه من API تسجيل الدخول

## الميزات المتاحة

### للأدمن:
1. **عرض جميع المواعيد** لليوم المحدد
2. **إحصائيات شاملة**:
   - إجمالي المواعيد
   - المواعيد النشطة
   - المواعيد المعطلة
   - المواعيد المحجوزة
   - المواعيد المتاحة

3. **التحكم في المواعيد**:
   - تشغيل/إيقاف موعد واحد
   - تشغيل جميع المواعيد
   - إيقاف جميع المواعيد
   - إلغاء حجز موعد

4. **واجهة سهلة الاستخدام**:
   - ألوان مختلفة للحالات
   - أيقونات واضحة
   - تحديث فوري

### للمستخدمين:
1. **عرض المواعيد المتاحة** فقط
2. **حجز المواعيد** المتاحة
3. **عدم إمكانية رؤية** المواعيد المعطلة

## هيكل قاعدة البيانات

### جدول `time_slots`
```sql
- id (Primary Key)
- hour (10-23) - الساعة
- label (String) - التسمية مثل "10:00 AM"
- is_active (Boolean) - نشط/معطل
- is_booked (Boolean) - محجوز/متاح
- date (Date) - التاريخ
- created_at, updated_at
```

## الأمان
- جميع endpoints الأدمن محمية بـ `admin` middleware
- التحقق من صلاحيات الأدمن
- حماية من التلاعب بالمواعيد المحجوزة

## التكامل مع النظام الحالي
- تم تحديث `OrderController::getBookedTimeSlots()` لاستخدام النظام الجديد
- النظام متوافق مع التطبيق الحالي
- لا يؤثر على البيانات الموجودة

## استكشاف الأخطاء

### مشكلة: لا تظهر المواعيد
- تأكد من تشغيل Migration
- تحقق من صحة token الأدمن
- تأكد من صلاحيات الأدمن في قاعدة البيانات

### مشكلة: لا يمكن تعديل المواعيد
- تحقق من middleware الأدمن
- تأكد من صحة البيانات المرسلة
- تحقق من logs الخادم

## التطوير المستقبلي
- إضافة إشعارات للمستخدمين عند تغيير المواعيد
- إحصائيات متقدمة
- تصدير التقارير
- جدولة تلقائية للمواعيد
